<!DOCTYPE html> <html> <head> <link rel="search" type="application/opensearchdescription+xml" href="../opensearch.xml" title="GitHub:Help" /> <title> Remove sensitive data </title> <link rel="icon" type="image/x-icon" href="../assets/images/site/favicon.ico"> <link rel="stylesheet" href="../assets/stylesheets/application.css"> <script src="../assets/application.js"></script> <script src="../assets/application_cs.js"></script> <meta name="Description" content=" Some day you or a collaborator may accidentally commit sensitive data, such as a password or SSH key, into a Git repository. Although you can remove the file from the latest commit with git rm, theâ€¦"> <script type="text/javascript"> $(function() { $('#quicksearch-query').lunrSearch({ indexUrl: '/search/search.json', quickSearchResults: '.autocomplete-results', quickSearchEntries: '.result-group', quickSearchTemplate: '#quicksearch-results-template', searchResults: '.search-container', searchEntries: '.search-results', searchTemplate: '#search-results-template' }); }); </script> <script type="text/javascript"> var _gaq = _gaq || []; _gaq.push(['_setAccount', 'UA-3769691-27']); _gaq.push(['_trackPageview']); (function() { var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true; ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s); })(); </script> <meta http-equiv="Content-Type" content="text/html;charset=utf-8" /> </head> <body id="com">


<!-- Copyright © 2005. Spidersoft Ltd -->
<style>
A.applink:hover {border: 2px dotted #DCE6F4;padding:2px;background-color:#ffff00;color:green;text-decoration:none}
A.applink       {border: 2px dotted #DCE6F4;padding:2px;color:#2F5BFF;background:transparent;text-decoration:none}
A.info          {color:#2F5BFF;background:transparent;text-decoration:none}
A.info:hover    {color:green;background:transparent;text-decoration:underline}
</style>
<div style='BORDER: 1px solid #DCE6F4; MARGIN-TOP: 20px; MARGIN-BOTTOM: 20px; MARGIN-LEFT: 5px; MARGIN-RIGHT: 5px; PADDING: 5px; BACKGROUND-COLOR: #eef8ff;line-height:180%; COLOR: #000000; font-family: Arial; font-size: 8pt; width=100%; FILTER: progid:DXImageTransform.Microsoft.Gradient(GradientType=0, StartColorStr="#FFFFFFFF", EndColorStr="#F2F5FAFF");'>
This page was saved using <a class="applink" href="http://www.spidersoft.com"><b>WebZIP 7.0.3.1030</b></a> <a class="applink" href="http://www.spidersoft.com"><b>offline browser</b></a>  (Unregistered) on  10/25/14 9:51:15.<br>
<b>Address:</b> <a class="info" href="https://help.github.com/articles/remove-sensitive-data">https://help.github.com/articles/remove-sensitive-data</a><br>
<b>Title:</b> Remove sensitive data &nbsp;&bull;&nbsp; <b>Size:</b> 14988 &nbsp;&bull;&nbsp; <b>Last Modified:</b> Thu, 23 Oct 2014 03:01:59 GMT<br></div>
<!-- /Copyright © 2005. Spidersoft Ltd -->

 <div id="not-footer"> <div id="header"> <div class="clearfix"> <h1 class="site-logo"><a href="../help.github.html">GitHub Help</a></h1> <ul class="top-nav"> <li><a href="https://github.com/contact">Contact Support</a></li> <li><a href="http://www.github.com/">Return to GitHub</a></li> </ul> </div> </div> <div id="content-wrapper"> <div class="site"> <div class="content-header small"> <h6 class="breadcrumbs"> <!-- hidden articles do not have categories --> <a href="../categories/advanced-git.html"> Advanced Git </a> / Remove sensitive data </h6> <div class="search-form small"> <script id="quicksearch-results-template" type="text/mustache"> <div class="header"> <a class="initial quicksearch-seemore" href="/search?q=">See more results</a> </div> {{#entries}} <tr class="article"> <td class="info"> <a href="{{url}}" class="js-articles-quicksearch-link">{{title}}</a> </td> </tr> {{/entries}} </script> <form accept-charset="UTF-8" action="/search" id="articles-search" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="&#x2713;" /></div> <div class="outer"> <div class="inner fade-label"> <input type="text" name="q" id="quicksearch-query" class="js-articles-quicksearch" placeholder="How can we help?" /> <button><span class="octicon octicon-search"></span>Search</button> </div> </div> </form> <div class="autocomplete-results" style="display: none;"> <table class="result-group" border="0" cellpadding="0" cellspacing="0"> </table> </div> </div> <span class="last-updated-at">Article last updated on <span class="last-modified-at-date">23-Oct-14</span></span> </div> <div class="article js-hide-during-search"> <h2>Remove sensitive data</h2> <div id="article-platform-nav"> <ul> <!-- http://bit.ly/TE6i98 --> <li class="platform-mac"> <a href="#platform-mac" data-platform="mac"> mac </a> </li> <li class="platform-windows"> <a href="#platform-windows" data-platform="windows"> windows </a> </li> <li class="platform-linux"> <a href="#platform-linux" data-platform="linux"> linux </a> </li> <li class="platform-all"> <a href="#platform-all" data-platform="all"> all </a> </li> </ul> </div> <div class="article-body content-body wikistyle markdown-format"> <div class="intro"> <p>Some day you or a collaborator may accidentally commit sensitive data, such as a password or SSH key, into a Git repository. Although you can remove the file from the latest commit with <code>git rm</code>, the file will still exist in the repository's history. Fortunately, there are other tools that can entirely remove unwanted files from a repository's history. This article will explain how to use two of them: <code>git filter-branch</code> and the <a href="http://rtyley.github.io/bfg-repo-cleaner/">BFG Repo-Cleaner</a>.</p> </div> <div class="alert error"> <p><strong>Danger: Once you have pushed a commit to GitHub, you should consider any data it contains to be compromised.</strong> If you committed a password, change it! If you committed a key, generate a new one.</p> <p>This article tells you how to make commits with sensitive data unreachable from any branches or tags in your GitHub repository. However, it's important to note that those commits may still be accessible in any clones or forks of your repository, directly via their SHA-1 hashes in cached views on GitHub, and through any pull requests that reference them. You can't do anything about existing clones or forks of your repository, but you can permanently remove all of your repository's cached views and pull requests on GitHub.com or GitHub Enterprise by contacting <a href="https://github.com/contact">GitHub support</a> or your site administrator, respectively.</p> </div> <h3> <a name="purging-a-file-from-your-repositorys-history" class="anchor" href="#purging-a-file-from-your-repositorys-history"><span class="octicon octicon-link"></span></a>Purging a file from your repository's history</h3> <h4> <a name="using-filter-branch" class="anchor" href="#using-filter-branch"><span class="octicon octicon-link"></span></a>Using filter-branch</h4> <p>To illustrate how <code>git filter-branch</code> works, we'll show you how to remove the Rakefile from the history of the <a href="https://github.com/defunkt/github-gem">GitHub gem</a> repository (and add it to <code>.gitignore</code> to ensure that it is not accidentally re-committed).</p> <ol> <li> <p>Clone the <a href="https://github.com/defunkt/github-gem">GitHub gem</a> repository.</p><pre class="command-line">
<span class="command">git clone https://github.com/defunkt/github-gem.git</span>
<span class="output"><span># </span>Initialized empty Git repository in /Users/tekkub/tmp/github-gem/.git/</span>
<span class="output"><span># </span>remote: Counting objects: 1301, done.</span>
<span class="output"><span># </span>remote: Compressing objects: 100% (769/769), done.</span>
<span class="output"><span># </span>remote: Total 1301 (delta 724), reused 910 (delta 522)</span>
<span class="output"><span># </span>Receiving objects: 100% (1301/1301), 164.39 KiB, done.</span>
<span class="output"><span># </span>Resolving deltas: 100% (724/724), done.</span>
</pre></li> <li> <p>Navigate to the repository's working directory.</p><pre class="command-line">
<span class="command">cd github-gem</span>
</pre></li> <li> <p>Run <code>git filter-branch</code>, forcing (<code>--force</code>) Git to processâ€”but not check out (<code>--index-filter</code>)â€”the entire history of every branch and tag (<code>--tag-name-filter cat -- --all</code>), removing the specified file (<code>'git rm --cached --ignore-unmatch Rakefile'</code>) and any empty commits generated as a result (<code>--prune-empty</code>). Note that you need to specify the <em>path</em> to the file you want to remove, not just its filename.</p> <p>Be careful! <em>This will overwrite your existing tags</em>.</p><pre class="command-line">
<span class="command">git filter-branch --force --index-filter \</span>
'git rm --cached --ignore-unmatch Rakefile' \
--prune-empty --tag-name-filter cat -- --all
<span class="output"><span># </span>Rewrite 48dc599c80e20527ed902928085e7861e6b3cbe6 (266/266)</span>
<span class="output"><span># </span>Ref 'refs/heads/master' was rewritten</span>
</pre><p>If the file used to exist at any other paths (because it was moved or renamed), you must run this command on those paths, as well.</p> </li> <li> <p>Add the Rakefile to <code>.gitignore</code> to ensure that you don't accidentally commit it again.</p><pre class="command-line">
<span class="command">echo "Rakefile" &gt;&gt; .gitignore</span>
<span class="command">git add .gitignore</span>
<span class="command">git commit -m "Add Rakefile to .gitignore"</span>
<span class="output"><span># </span>[master 051452f] Add Rakefile to .gitignore</span>
<span class="output"><span># </span> 1 files changed, 1 insertions(+), 0 deletions(-)</span>
</pre></li> <li><p>Double-check that you've removed everything you wanted to from your repository's history, and that all of your branches are checked out.</p></li> <li> <p>Once you're happy with the state of your repository, force-push your local changes to overwrite your GitHub repository, as well as all the branches you've pushed up:</p><pre class="command-line">
<span class="command">git push origin --force --all</span>
<span class="output"><span># </span>Counting objects: 1074, done.</span>
<span class="output"><span># </span>Delta compression using 2 threads.</span>
<span class="output"><span># </span>Compressing objects: 100% (677/677), done.</span>
<span class="output"><span># </span>Writing objects: 100% (1058/1058), 148.85 KiB, done.</span>
<span class="output"><span># </span>Total 1058 (delta 590), reused 602 (delta 378)</span>
<span class="output"><span># </span>To https://github.com/defunkt/github-gem.git</span>
<span class="output"><span># </span> + 48dc599...051452f master -&gt; master (forced update)</span>
</pre></li> <li> <p>In order to remove the sensitive file from <a href="about-releases.html">your tagged releases</a>, you'll also need to force-push against your Git tags:</p><pre class="command-line">
<span class="command">git push origin --force --tags</span>
<span class="output"><span># </span>Counting objects: 321, done.</span>
<span class="output"><span># </span>Delta compression using up to 8 threads.</span>
<span class="output"><span># </span>Compressing objects: 100% (166/166), done.</span>
<span class="output"><span># </span>Writing objects: 100% (321/321), 331.74 KiB | 0 bytes/s, done.</span>
<span class="output"><span># </span>Total 321 (delta 124), reused 269 (delta 108)</span>
<span class="output"><span># </span>To https://github.com/defunkt/github-gem.git</span>
<span class="output"><span># </span> + 48dc599...051452f master -&gt; master (forced update)</span>
</pre></li> <li><p>Tell your collaborators to <a href="http://git-scm.com/book/en/Git-Branching-Rebasing">rebase</a>, <em>not</em> merge, any branches they created off of your old (tainted) repository history. One merge commit could reintroduce some or all of the tainted history that you just went to the trouble of purging.</p></li> <li> <p>After some time has passed and you're confident that <code>git filter-branch</code> had no unintended side effects, you can force all objects in your local repository to be dereferenced and garbage collected with the following commands (using Git 1.8.5 or newer):</p><pre class="command-line">
<span class="command">git for-each-ref --format='delete %(refname)' refs/original | git update-ref --stdin</span>
<span class="command">git reflog expire --expire=now --all</span>
<span class="command">git gc --prune=now</span>
<span class="output"><span># </span>Counting objects: 2437, done.</span>
<span class="output"><span># </span>Delta compression using up to 4 threads.</span>
<span class="output"><span># </span>Compressing objects: 100% (1378/1378), done.</span>
<span class="output"><span># </span>Writing objects: 100% (2437/2437), done.</span>
<span class="output"><span># </span>Total 2437 (delta 1461), reused 1802 (delta 1048)</span>
</pre><p>Note that you can also achieve this by pushing your filtered history to a new or empty GitHub repository and then making a fresh clone from GitHub.</p> </li> </ol> <h4> <a name="using-the-bfg" class="anchor" href="#using-the-bfg"><span class="octicon octicon-link"></span></a>Using the BFG</h4> <p>The <a href="http://rtyley.github.io/bfg-repo-cleaner/">BFG Repo-Cleaner</a> is a faster, simpler alternative to <code>git filter-branch</code> for removing unwanted data. For example, to remove any file named 'Rakefile' (and leave your latest commit untouched), run:</p><pre class="command-line">
<span class="command">bfg --delete-files Rakefile</span>
</pre><p>To replace all text listed in <code>passwords.txt</code> wherever it can be found in your repository's history, run:</p><pre class="command-line">
<span class="command">bfg --replace-text passwords.txt</span>
</pre><p>See the <a href="http://rtyley.github.io/bfg-repo-cleaner/">BFG Repo-Cleaner</a>'s documentation for full usage and download instructions.</p> <h2> <a name="avoiding-accidental-commits-in-the-future" class="anchor" href="#avoiding-accidental-commits-in-the-future"><span class="octicon octicon-link"></span></a>Avoiding accidental commits in the future</h2> <p>There are a few simple tricks to avoid committing things you don't want committed:</p> <ul> <li>Use a visual program like <a href="https://mac.github.com/">GitHub for Mac</a> or <a href="http://git-scm.com/docs/gitk">gitk</a> to commit changes. Visual programs generally make it easier to see exactly which files will be added, deleted, and modified with each commit.</li> <li>Avoid the catch-all commands <code>git add .</code> and <code>git commit -a</code> on the command lineâ€”use <code>git add filename</code> and <code>git rm filename</code> to individually stage files, instead.</li> <li>Use <code>git add --interactive</code> to individually review and stage changes within each file.</li> <li>Use <code>git diff --cached</code> to review the changes that you have staged for commit. This is the exact diff that <code>git commit</code> will produce as long as you don't use the <code>-a</code> flag.</li> </ul> <h3> <a name="further-reading" class="anchor" href="#further-reading"><span class="octicon octicon-link"></span></a>Further reading</h3> <ul> <li><a href="http://git-scm.com/docs/git-filter-branch"><code>git filter-branch</code> man page</a></li> <li><a href="http://git-scm.com/book/en/Git-Tools-Rewriting-History">Pro Git: Git Tools - Rewriting History</a></li> </ul> </div> <div class="support-footer"> <hr /> <ul class="article-footer button-nav"> <li> <a href="https://github.com/contact" class="minibutton"> <span class="octicon octicon-comment-discussion"></span> Contact a human </a> </li> </ul> </div> </div> <div class="clear"></div> </div> </div> </div> <div id="footer"> <div class="inner"> <a href="https://github.com/" class="invertocat"> <img alt="The GitHub Logo" src="../assets/images/site/invertocat.png" width="24" height="24" /> </a> <p class="left"> &copy; <span id="year">2014</span> GitHub Inc. All rights reserved. </p> <ul class="links right"> <li><a href="../terms-of-service.html">Terms of Service</a></li> <li><a href="../privacy-policy.html">Privacy</a></li> <li><a href="../security.html">Security</a></li> </ul> </div> </div> </body> </html>
